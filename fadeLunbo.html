<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>淡入淡出轮播</title>
	<style type="text/css">
		*{margin: 0;padding: 0;list-style:none;}
		.demo{width:490px;height:170px;border:solid 1px #000;margin:50px auto;position:relative;}
		ul{position:relative;width:100%;height:100%;}
		ul li{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;}
		ul li a{display:block;width:100%;height:100%;}
		ul li a img{display:block;width:100%;}
		ol{position:absolute;bottom:5px;overflow:hidden;}
		ol li{float:left;width:10px;height:10px;border-radius:50%;border:solid 1px #fff;margin:5px;cursor:pointer;}
		ol li.current{background:#fff;}
		.btn{position:absolute;top:50%;width:20px;height:30px;background:#ccc;color:#000;text-decoration: none;text-align:center;line-height:30px;margin-top:-15px;opacity:0;}
		#lbtn{left:0;}
		#rbtn{right:0;}
	</style>
</head>
<body>
	<div class="demo" id="demo">
		<ul id="fade">
			<li><a href="javascript:;"><img src="./images/01.jpg" height="170" width="490" alt=""></a></li>
			<li><a href="javascript:;"><img src="./images/02.jpg" alt=""></a></li>
			<li><a href="javascript:;"><img src="./images/03.jpg" alt=""></a></li>
			<li><a href="javascript:;"><img src="./images/04.jpg" alt=""></a></li>
			<li><a href="javascript:;"><img src="./images/05.jpg" alt=""></a></li>
		</ul>
		<a href="javascript:;" class="btn" id="lbtn">←</a>
		<a href="javascript:;" class="btn" id="rbtn">→</a>
	</div>
</body>
<script type="text/javascript">
fadeUp({fadeCount:"demo",fadeUl:"fade",fadeBtn:["lbtn","rbtn"],fadeDot:true,fadePosit:"center"});
function fadeUp(obj){
	// 父容器:fadeCount:id
	//切换的元素的父元素:fadeUl:id
	// 按钮: fadeBtn:[id]
	// 小圆点:fadeDot:boolean
	// 小圆点的位置：fadePosit:string
	// 初始化样式
	var demo = document.getElementById(obj.fadeCount); 
	var fadeUl = document.getElementById(obj.fadeUl);
	var lis = fadeUl.children;
	lis[0].style.opacity = 1;
	// 小圆点
	if(obj.fadeDot){
		var ol = document.createElement("ol");
		for(j = 0 ; j < lis.length ; j++){
			var li = document.createElement("li");
			ol.appendChild(li);
		};
		demo.appendChild(ol);
		var olWidth = ol.offsetWidth;
		switch(obj.fadePosit){
			case "left":ol.style.left = "5px";
			break;
			case "center":ol.style.left = "50%";ol.style.marginLeft = -olWidth/2+"px";
			break;
			case "right":ol.style.right = "5px";
		};
		var olLis = ol.children;
		olLis[0].className = "current";
		// 小圆点点击事件
		for(j = 0 ; j < olLis.length; j++){
			olLis[j].index = j;
			olLis[j].onclick = function(){
				if(onOff){
					onOff = false;
					var s = this.index;
					index = s;
					common();
				};
			};
		};
	};
	// 获取按钮
	if(obj.fadeBtn){
		var lbtn = document.getElementById(obj.fadeBtn[0]);
		var rbtn = document.getElementById(obj.fadeBtn[1]);
		// 按钮点击事件
		var onOff = true;
		lbtn.onclick = function(){
			if( onOff ){
				onOff = false;
				lclick();
			}
		};
		rbtn.onclick = function(){
			if( onOff ){
				onOff = false;
				rclick();
			}
		};
	};
	// 大盒子的hover事件
	demo.onmouseover = function(){
		clearInterval(timer);
		if(obj.fadeBtn){
			animate(lbtn,{"opacity":1});
			animate(rbtn,{"opacity":1});
		};
	};
	demo.onmouseout = function(){
		timer = setInterval(rclick, 3000);
		if(obj.fadeBtn){
			animate(lbtn,{"opacity":0});
			animate(rbtn,{"opacity":0});
		};
	};
	// 自动切换
	var index = 0,timer = null;
	timer = setInterval(rclick, 3000);
	// 右侧点击事件
	function rclick(){
		index++;
		if(index>lis.length-1){
			index = 0;
		};
		common();
	};
	function lclick(){
		index--;
		if(index<0){
			index = lis.length -1;
		};
		common();
	}
	function common(){
		for( i = 0 ; i < lis.length ; i++){
			animate(lis[i],{"opacity":0});
		};
		animate(lis[index],{"opacity":1},function(){onOff = true});
		if(obj.fadeDot){
			for( k = 0 ; k < lis.length ; k++){
				olLis[k].className = "";
			};
			olLis[index].className = "current";
		};
	};
	// 获取当前样式
	function getStyle(ele,attr){
		if(window.getComputedStyle){
			return window.getComputedStyle(ele,null)[attr];
		}else{
			return ele.currentStyle[attr];
		};
	};
	// 缓动动画库
	function animate(ele,obj,fn){
		clearInterval(ele.timer);
		ele.timer = setInterval(function(){
			var flog = true;
			for(k in obj){
				if(k == "zIndex"){
					ele.style[k] = obj[k];
				}else if(k == "opacity"){
					var target = obj[k]*100;
					var leader = getStyle(ele,k)*100;
					var step = (target-leader)/10;
					step = step > 0 ? Math.ceil(step):Math.floor(step);
					leader = leader+step;
					ele.style[k] = leader/100
				}else{
					var target = obj[k];
					var leader = parseInt(getStyle(ele,k));
					var step = (target-leader)/10;
					step = step > 0 ? Math.ceil(step):Math.floor(step);
					leader = leader+step;
					ele.style[k] = leader+"px";
				};
				if( leader !== target ){
					flog = false;
				};
			};
			if( flog ){
				clearInterval(ele.timer);
				if( fn ){
					fn();
				};
			};
		},15);
	};
};
</script>
</html>